<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_25) on Tue Dec 10 10:08:12 EST 2013 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>TreeBuilder (akiban-persistit 3.3.1-SNAPSHOT API)</title>
<meta name="date" content="2013-12-10">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="TreeBuilder (akiban-persistit 3.3.1-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TreeBuilder.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../com/persistit/Tree.TreeVersionException.html" title="class in com.persistit"><span class="strong">Prev Class</span></a></li>
<li><a href="../../com/persistit/TreeSelector.html" title="class in com.persistit"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?com/persistit/TreeBuilder.html" target="_top">Frames</a></li>
<li><a href="TreeBuilder.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.persistit</div>
<h2 title="Class TreeBuilder" class="title">Class TreeBuilder</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.persistit.TreeBuilder</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">TreeBuilder</span>
extends <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block"><p>
 A mechanism for optimizing the process of loading large sets of records with
 non-sequential keys. This class speeds up the process of inserting records
 into a set of Persistit <code>Tree</code>s by sorting them before inserting
 them. The sort process uses multiple "sort trees" in multiple temporary
 <code>Volume</code>s to hold copies of the data. These are then merged into
 the final "destination trees." Each sort tree is constrained to be small
 enough to fit in the <a href="../../com/persistit/BufferPool.html" title="class in com.persistit"><code>BufferPool</code></a>.
 </p>
 <h3>Background</h3>
 <p>
 In general, Persistit can store records very quickly, even when the keys of
 those records arrive in random order, as long as all the pages of the
 destination tree or trees are resident in the buffer pool. However, the
 situation changes dramatically as soon as the the destination tree or trees
 exceed the size of the buffer pool. Once that happens, insert performance
 degrades because the ratio of records inserted per disk I/O operation
 performed decreases. In a worst-case scenario, inserting each new key may
 require two or more disk I/O operations. These may occur because Persistit
 performs the following steps:
 <ul>
 <li>Look up the key requires reading the page containing that key from disk
 into the BufferPool.</li>
 <li>Reading the page requires a Buffer containing some other page to be
 evicted.</li>
 <li>The page being evicted is likely to be dirty and therefore Persistit must
 write its contents to disk before reusing the Buffer.</li>
 </ul>
 Further, these disk I/O operations are are usually at unrelated file
 positions and therefore may each require random seeks. As a result, inserting
 one key can take orders of magnitude longer once the tree no longer fits in
 the buffer pool.
 </p>
 <p>
 <code>TreeBuilder</code> mitigates that degradation by sorting the keys
 before inserting them into their final destination trees. To do so it builds
 a collection of bounded-size sort trees in temporary volumes. Then it
 performs a merge sort from those trees into the final destination tree or
 trees. This mechanism eliminates the problem that every key insertion
 requires two (or more) random disk I/O operations. However, it is still the
 case that every sort tree page must be written and read once, and every
 destination tree page must be written at least once. Therefore the I/O
 associated with TreeBuilder is reduced but not eliminated.
 </p>
 <p>
 TreeBuilder is effective if and only if (a) the keys arrive in random order,
 and (b) the data is significantly larger than available memory in the buffer
 pool. In general it is faster to insert the keys directly into the
 destination trees unless both of these conditions are true.
 </p>
 <h3>Using TreeBuilder</h3>
 <p>
 The following example demonstrates the fundamental operation of
 <code>TreeBuilder</code>: <code><pre>
   Exchange exchange = db.getExchange("myVolume", "myTree", true);
   TreeBuilder tb = new TreeBuilder(db);
   //
   // Insert the data into sort trees
   //
   while (<i>source has more data</i>) {
      exchange.to(<i>next key</i>).getValue().put(<i>next value</i>);
      tb.store(exchange);
   }
   //
   // Merge the data into myTree
   // 
   tb.merge();
 </pre></code> Note that a TreeBuilder can pre-sort data for multiple
 destination trees. For example, it is possible to load and merge records for
 a table and its corresponding indexes in one pass using TreeBuilder. During
 the merge operation the final destination <code>Tree</code> are built in
 sequence. By default that sequence is by alphabetical order of tree name, but
 it is possible to customize TreeBuilder to change that order.
 </p>
 <p>
 Loading a large data set may take a long time under the best of
 circumstances. Therefore this class is designed to be extended by
 applications to support progress reporting, to control disk space allocation,
 to handle attempts to insert conflicting records with duplicate keys, etc.
 See the following methods which may be overridden to provide custom behavior:
 <ul>
 <li><a href="../../com/persistit/TreeBuilder.html#reportSorted(long)"><code>reportSorted(long)</code></a> - report completion of N records inserts into
 sort trees</li>
 <li><a href="../../com/persistit/TreeBuilder.html#reportMerged(long)"><code>reportMerged(long)</code></a> - report completion of N records merged</li>
 <li><a href="../../com/persistit/TreeBuilder.html#duplicateKeyDetected(com.persistit.Tree, com.persistit.Key, com.persistit.Value, com.persistit.Value)"><code>duplicateKeyDetected(Tree, Key, Value, Value)</code></a> - handle detection
 of records inserted with duplicate keys</li>
 <li><a href="../../com/persistit/TreeBuilder.html#beforeMergeKey(com.persistit.Exchange)"><code>beforeMergeKey(Exchange)</code></a> - allowing filtering or custom handling
 per record while merging</li>
 <li><a href="../../com/persistit/TreeBuilder.html#afterMergeKey(com.persistit.Exchange)"><code>afterMergeKey(Exchange)</code></a> - customizable behavior after merging
 one record</li>
 <li><a href="../../com/persistit/TreeBuilder.html#beforeSortVolumeClosed(com.persistit.Volume, java.io.File)"><code>beforeSortVolumeClosed(Volume, File)</code></a> - customizable behavior
 before closing a sort volume when full</li>
 <li><a href="../../com/persistit/TreeBuilder.html#afterSortVolumeClose(com.persistit.Volume, java.io.File)"><code>afterSortVolumeClose(Volume, File)</code></a> - customizable behavior after
 closing a sort volume when full</li>
 <li><a href="../../com/persistit/TreeBuilder.html#getTreeComparator()"><code>getTreeComparator()</code></a> - return a custom Comparator to determine
 sequence in which trees are populated within the <a href="../../com/persistit/TreeBuilder.html#merge()"><code>merge()</code></a> method
 </ul>
 </p></div>
<dl><dt><span class="strong">Author:</span></dt>
  <dd>peter</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../com/persistit/TreeBuilder.html#TreeBuilder(com.persistit.Persistit)">TreeBuilder</a></strong>(<a href="../../com/persistit/Persistit.html" title="class in com.persistit">Persistit</a>&nbsp;persistit)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><strong><a href="../../com/persistit/TreeBuilder.html#TreeBuilder(com.persistit.Persistit, java.lang.String, int, float)">TreeBuilder</a></strong>(<a href="../../com/persistit/Persistit.html" title="class in com.persistit">Persistit</a>&nbsp;persistit,
           <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;name,
           int&nbsp;pageSize,
           float&nbsp;bufferPoolFraction)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#afterMergeKey(com.persistit.Exchange)">afterMergeKey</a></strong>(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)</code>
<div class="block">This method may be extended to provide custom behavior after merging one
 record.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#afterSortVolumeClose(com.persistit.Volume, java.io.File)">afterSortVolumeClose</a></strong>(<a href="../../com/persistit/Volume.html" title="class in com.persistit">Volume</a>&nbsp;volume,
                    <a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)</code>
<div class="block">This method may be extended to provide application-specific reporting
 functionality after a sort volume has been filled to capacity and has
 been evicted.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#beforeMergeKey(com.persistit.Exchange)">beforeMergeKey</a></strong>(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)</code>
<div class="block">This method may be extended to provide alternative functionality.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#beforeSortVolumeClosed(com.persistit.Volume, java.io.File)">beforeSortVolumeClosed</a></strong>(<a href="../../com/persistit/Volume.html" title="class in com.persistit">Volume</a>&nbsp;volume,
                      <a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)</code>
<div class="block">This method may be extended to provide application-specific behavior when
 a sort volume has been filled to capacity.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#clear()">clear</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#duplicateKeyDetected(com.persistit.Tree, com.persistit.Key, com.persistit.Value, com.persistit.Value)">duplicateKeyDetected</a></strong>(<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&nbsp;tree,
                    <a href="../../com/persistit/Key.html" title="class in com.persistit">Key</a>&nbsp;key,
                    <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;v1,
                    <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;v2)</code>
<div class="block">
 This method may be extended to provide application-specific behavior when
 an attempt is made to merge records with duplicate keys.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getMergedKeyCount()">getMergedKeyCount</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getName()">getName</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getReportKeyCountMultiple()">getReportKeyCountMultiple</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getSortedKeyCount()">getSortedKeyCount</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getSortFileCount()">getSortFileCount</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getSortFileDirectories()">getSortFileDirectories</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Comparator.html?is-external=true" title="class or interface in java.util">Comparator</a>&lt;<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getTreeComparator()">getTreeComparator</a></strong>()</code>
<div class="block">This method may be extended to provide an application-specific ordering
 on <code>Tree</code>s.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#getTrees()">getTrees</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#merge()">merge</a></strong>()</code>
<div class="block">Merge the record previously stored in sort volumes into their destination
 <code>Tree</code>s.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#reportMerged(long)">reportMerged</a></strong>(long&nbsp;count)</code>
<div class="block">This method may be extended to provide application-specific progress
 reports.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#reportSorted(long)">reportSorted</a></strong>(long&nbsp;count)</code>
<div class="block">This method may be extended to provide application-specific progress
 reports.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#setReportKeyCountMultiple(long)">setReportKeyCountMultiple</a></strong>(long&nbsp;multiple)</code>
<div class="block">Set the count of keys inserted or merged per call to
 <a href="../../com/persistit/TreeBuilder.html#reportSorted(long)"><code>reportSorted(long)</code></a> or <a href="../../com/persistit/TreeBuilder.html#reportMerged(long)"><code>reportMerged(long)</code></a>.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#setSortTreeDirectories(java.util.List)">setSortTreeDirectories</a></strong>(<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;directories)</code>
<div class="block">
 Define a list of directories in which sort volumes will be created.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#store(com.persistit.Exchange)">store</a></strong>(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)</code>
<div class="block">Store a key-value pair into a sort tree.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../com/persistit/TreeBuilder.html#store(com.persistit.Tree, com.persistit.Key, com.persistit.Value)">store</a></strong>(<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&nbsp;tree,
     <a href="../../com/persistit/Key.html" title="class in com.persistit">Key</a>&nbsp;key,
     <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;value)</code>
<div class="block">Store a key-value pair for a specified <code>Tree</code> into a sort
 tree.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TreeBuilder(com.persistit.Persistit)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>TreeBuilder</h4>
<pre>public&nbsp;TreeBuilder(<a href="../../com/persistit/Persistit.html" title="class in com.persistit">Persistit</a>&nbsp;persistit)</pre>
</li>
</ul>
<a name="TreeBuilder(com.persistit.Persistit, java.lang.String, int, float)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TreeBuilder</h4>
<pre>public&nbsp;TreeBuilder(<a href="../../com/persistit/Persistit.html" title="class in com.persistit">Persistit</a>&nbsp;persistit,
           <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;name,
           int&nbsp;pageSize,
           float&nbsp;bufferPoolFraction)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getName()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getName</h4>
<pre>public final&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;getName()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>Name provide when TreeBuilder was constructed. Default name is
         "TreeBuilder".</dd></dl>
</li>
</ul>
<a name="setReportKeyCountMultiple(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setReportKeyCountMultiple</h4>
<pre>public final&nbsp;void&nbsp;setReportKeyCountMultiple(long&nbsp;multiple)</pre>
<div class="block">Set the count of keys inserted or merged per call to
 <a href="../../com/persistit/TreeBuilder.html#reportSorted(long)"><code>reportSorted(long)</code></a> or <a href="../../com/persistit/TreeBuilder.html#reportMerged(long)"><code>reportMerged(long)</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>multiple</code> - </dd></dl>
</li>
</ul>
<a name="getReportKeyCountMultiple()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getReportKeyCountMultiple</h4>
<pre>public final&nbsp;long&nbsp;getReportKeyCountMultiple()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>Count of keys inserted or merged per call to
         <a href="../../com/persistit/TreeBuilder.html#reportSorted(long)"><code>reportSorted(long)</code></a> or <a href="../../com/persistit/TreeBuilder.html#reportMerged(long)"><code>reportMerged(long)</code></a></dd></dl>
</li>
</ul>
<a name="getSortFileCount()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSortFileCount</h4>
<pre>public final&nbsp;int&nbsp;getSortFileCount()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>Count of sort trees that have been created while sorting keys</dd></dl>
</li>
</ul>
<a name="getSortedKeyCount()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSortedKeyCount</h4>
<pre>public&nbsp;long&nbsp;getSortedKeyCount()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>Number of keys stored in sort trees</dd></dl>
</li>
</ul>
<a name="getMergedKeyCount()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMergedKeyCount</h4>
<pre>public&nbsp;long&nbsp;getMergedKeyCount()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>Number of keys merged into destination trees</dd></dl>
</li>
</ul>
<a name="getTrees()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTrees</h4>
<pre>public final&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&gt;&nbsp;getTrees()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>List of destination
         <code>Tree<code> instances. This list is built as keys are stored.</dd></dl>
</li>
</ul>
<a name="setSortTreeDirectories(java.util.List)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setSortTreeDirectories</h4>
<pre>public final&nbsp;void&nbsp;setSortTreeDirectories(<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;directories)
                                  throws <a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block"><p>
 Define a list of directories in which sort volumes will be created. This
 method can be used to override the default value provided by
 <a href="../../com/persistit/Configuration.html#getTmpVolDir()"><code>Configuration.getTmpVolDir()</code></a> to control more closely where sort
 trees will be stored. If the list is empty then the directory defined by
 the <code>Configuration</code> will be used. If multiple directories are
 declared then volumes will be allocated to them in round-robin fashion.
 This technique can distribute large load sets over multiple volumes and
 can allow for interleaved disk reads during the merge process.
 </p>
 <p>
 If a <code>File</code> supplied to this method does not exist, an attempt
 is made to create it as a directory. This method also attempts to create
 and delete a file in each supplied directory to ensure that if there is a
 file permission or other problem, it is detected immediately, rather than
 much later during the sort process.
 </p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>directories</code> - List of <code>File</code> instances, each of which must be a
            directory</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if a supplied file exists and is not a directory or cannot be
             created as a new directory</dd>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if an attempt to create a file in one of the supplied
             directories fails</dd></dl>
</li>
</ul>
<a name="getSortFileDirectories()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSortFileDirectories</h4>
<pre>public final&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&gt;&nbsp;getSortFileDirectories()</pre>
<dl><dt><span class="strong">Returns:</span></dt><dd>List of directories set via the
         <a href="../../com/persistit/TreeBuilder.html#setSortTreeDirectories(java.util.List)"><code>setSortTreeDirectories(List)</code></a> method.</dd></dl>
</li>
</ul>
<a name="store(com.persistit.Exchange)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>store</h4>
<pre>public final&nbsp;void&nbsp;store(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)
                 throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">Store a key-value pair into a sort tree. The <a href="../../com/persistit/Tree.html" title="class in com.persistit"><code>Tree</code></a>, <a href="../../com/persistit/Key.html" title="class in com.persistit"><code>Key</code></a>
 and <a href="../../com/persistit/Value.html" title="class in com.persistit"><code>Value</code></a> are specified by the supplied <a href="../../com/persistit/Exchange.html" title="class in com.persistit"><code>Exchange</code></a>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>exchange</code> - The Exchange</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="store(com.persistit.Tree, com.persistit.Key, com.persistit.Value)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>store</h4>
<pre>public final&nbsp;void&nbsp;store(<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&nbsp;tree,
         <a href="../../com/persistit/Key.html" title="class in com.persistit">Key</a>&nbsp;key,
         <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;value)
                 throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">Store a key-value pair for a specified <code>Tree</code> into a sort
 tree.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>tree</code> - the Tree</dd><dd><code>key</code> - the Key</dd><dd><code>value</code> - the Value</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="merge()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>merge</h4>
<pre>public&nbsp;void&nbsp;merge()
           throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">Merge the record previously stored in sort volumes into their destination
 <code>Tree</code>s.</div>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="clear()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clear</h4>
<pre>public&nbsp;void&nbsp;clear()
           throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="beforeSortVolumeClosed(com.persistit.Volume, java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>beforeSortVolumeClosed</h4>
<pre>protected&nbsp;void&nbsp;beforeSortVolumeClosed(<a href="../../com/persistit/Volume.html" title="class in com.persistit">Volume</a>&nbsp;volume,
                          <a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)
                               throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">This method may be extended to provide application-specific behavior when
 a sort volume has been filled to capacity. Subsequent to this call, the
 sort volume is streamed to a sort file and then its pages in the
 <code>BufferPool</code> are invalidated to allow their immediate reuse.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>volume</code> - The temporary <code>Volume</code> that has been filled</dd><dd><code>file</code> - the file to which the sorted key-value pairs will be written</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="afterSortVolumeClose(com.persistit.Volume, java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>afterSortVolumeClose</h4>
<pre>protected&nbsp;void&nbsp;afterSortVolumeClose(<a href="../../com/persistit/Volume.html" title="class in com.persistit">Volume</a>&nbsp;volume,
                        <a href="http://docs.oracle.com/javase/6/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;file)
                             throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">This method may be extended to provide application-specific reporting
 functionality after a sort volume has been filled to capacity and has
 been evicted. An application may also modify the temporary directory set
 via <a href="../../com/persistit/TreeBuilder.html#setSortTreeDirectories(java.util.List)"><code>setSortTreeDirectories(List)</code></a> within this method if necessary
 to adjust disk space utilization, for example. The default behavior of
 this method is to do nothing.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>volume</code> - The temporary <code>Volume</code> that has been filled</dd><dd><code>file</code> - the file to which the sorted key-value pairs have been written</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="duplicateKeyDetected(com.persistit.Tree, com.persistit.Key, com.persistit.Value, com.persistit.Value)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>duplicateKeyDetected</h4>
<pre>protected&nbsp;boolean&nbsp;duplicateKeyDetected(<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&nbsp;tree,
                           <a href="../../com/persistit/Key.html" title="class in com.persistit">Key</a>&nbsp;key,
                           <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;v1,
                           <a href="../../com/persistit/Value.html" title="class in com.persistit">Value</a>&nbsp;v2)
                                throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block"><p>
 This method may be extended to provide application-specific behavior when
 an attempt is made to merge records with duplicate keys. The two
 <code>Value</code>s v1 and v2 are provided in the order they were
 inserted into the <code>TreeBuilder</code>. behavior is to write a
 warning to the log and retain the first value..
 </p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>tree</code> - the <code>Tree</code> to which a key is being merged</dd><dd><code>key</code> - the <code>Key</code></dd><dd><code>v1</code> - the <code>Value</code> previously inserted</dd><dd><code>v2</code> - the conflicting <code>Value</code></dd>
<dt><span class="strong">Returns:</span></dt><dd><code>true</code> to replace the value previously stored,
         <code>false</code> to leave the value first inserted and ignore
         the new value.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../com/persistit/exception/DuplicateKeyException.html" title="class in com.persistit.exception">DuplicateKeyException</a></code> - if a key being inserted or merged matches a key already
             exists</dd>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="beforeMergeKey(com.persistit.Exchange)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>beforeMergeKey</h4>
<pre>protected&nbsp;boolean&nbsp;beforeMergeKey(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)
                          throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">This method may be extended to provide alternative functionality. The
 default implementation merely returns <code>true</code> which signifies
 that the key-value pair represented in the <code>Exchange</code> should
 be merged into the destination <code>Tree</code>. A custom implementation
 could be used to filter out unwanted records or to emit records to a
 different destination.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>exchange</code> - represents the key-value pair proposed for merging</dd>
<dt><span class="strong">Returns:</span></dt><dd><code>true</code> to allow the record to be merged</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="afterMergeKey(com.persistit.Exchange)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>afterMergeKey</h4>
<pre>protected&nbsp;void&nbsp;afterMergeKey(<a href="../../com/persistit/Exchange.html" title="class in com.persistit">Exchange</a>&nbsp;exchange)
                      throws <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></pre>
<div class="block">This method may be extended to provide custom behavior after merging one
 record. The default implementation does nothing. This method is called
 only if the corresponding call to <a href="../../com/persistit/TreeBuilder.html#beforeMergeKey(com.persistit.Exchange)"><code>beforeMergeKey(Exchange)</code></a>
 returned <code>true</code>.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>exchange</code> - represents the key-value pair that was merged.</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</a></code></dd></dl>
</li>
</ul>
<a name="reportSorted(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reportSorted</h4>
<pre>protected&nbsp;void&nbsp;reportSorted(long&nbsp;count)</pre>
<div class="block">This method may be extended to provide application-specific progress
 reports. By default it does nothing. This method is called after
 inserting a number of records into sort trees. The method
 <a href="../../com/persistit/TreeBuilder.html#setReportKeyCountMultiple(long)"><code>setReportKeyCountMultiple(long)</code></a> determines the frequency at
 which this method is called.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>count</code> - The total number of recirds that has been merged so far.</dd></dl>
</li>
</ul>
<a name="reportMerged(long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reportMerged</h4>
<pre>protected&nbsp;void&nbsp;reportMerged(long&nbsp;count)</pre>
<div class="block">This method may be extended to provide application-specific progress
 reports. By default it does nothing. This method is called after merging
 a number of records into destination trees. The method
 <a href="../../com/persistit/TreeBuilder.html#setReportKeyCountMultiple(long)"><code>setReportKeyCountMultiple(long)</code></a> determines the frequency at
 which this method is called.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>count</code> - The total number of recirds that has been merged so far.</dd></dl>
</li>
</ul>
<a name="getTreeComparator()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getTreeComparator</h4>
<pre>protected&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/util/Comparator.html?is-external=true" title="class or interface in java.util">Comparator</a>&lt;<a href="../../com/persistit/Tree.html" title="class in com.persistit">Tree</a>&gt;&nbsp;getTreeComparator()</pre>
<div class="block">This method may be extended to provide an application-specific ordering
 on <code>Tree</code>s. This ordering determines the sequence in which
 destination trees are built from the sort data. By default trees are
 build in alphabetical order by volume and tree name. However, an
 application may choose a different order to ensure invariants for
 concurrent use.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>a <code>java.util.Comparator</code> on <code>Tree</code></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TreeBuilder.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../com/persistit/Tree.TreeVersionException.html" title="class in com.persistit"><span class="strong">Prev Class</span></a></li>
<li><a href="../../com/persistit/TreeSelector.html" title="class in com.persistit"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?com/persistit/TreeBuilder.html" target="_top">Frames</a></li>
<li><a href="TreeBuilder.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2005&#x2013;2013 <a href="http://www.akiban.com">Akiban Technologies, Inc</a>. All rights reserved.</small></p>
</body>
</html>
